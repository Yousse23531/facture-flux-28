# FacturePro - Guide des Fonctionnalit√©s

## üìã Vue d'ensemble

Application web compl√®te de facturation adapt√©e au contexte tunisien avec support natif du Dinar Tunisien (TND) et conformit√© aux normes fiscales tunisiennes.

---

## üéØ Fonctionnalit√©s Impl√©ment√©es

### 1. üë• Gestion des Clients

**Page : `/clients`**

#### Fonctionnalit√©s
- ‚úÖ Liste compl√®te des clients avec recherche en temps r√©el
- ‚úÖ Affichage en grille avec informations cl√©s (nom, email, t√©l√©phone, ville)
- ‚úÖ Navigation vers les d√©tails client au clic

**Page : `/clients/:id` (Formulaire client)**

#### Champs disponibles
- Nom / Raison sociale (requis)
- Email (requis)
- T√©l√©phone (format tunisien : +216 XX XXX XXX)
- Matricule fiscal (format tunisien : XXXXXXX/X/X/XXX)
- Num√©ro TVA (format : TN XXXXXXXX)
- Adresse compl√®te
- Ville
- Code postal
- Pays (par d√©faut : Tunisie)
- Notes

#### Actions
- ‚úÖ Cr√©er un nouveau client
- ‚úÖ Modifier un client existant
- ‚úÖ Supprimer un client (avec confirmation)
- ‚úÖ Validation des donn√©es en temps r√©el
- ‚úÖ Messages de succ√®s/erreur

---

### 2. üì¶ Gestion des Produits & Services

**Page : `/products`**

#### Fonctionnalit√©s
- ‚úÖ Catalogue de produits en grille
- ‚úÖ Recherche par nom de produit
- ‚úÖ Badge actif/inactif
- ‚úÖ Affichage du prix HT en TND
- ‚úÖ Taux de TVA visible

**Page : `/products/:id` (Formulaire produit)**

#### Champs disponibles
- Nom du produit/service (requis)
- R√©f√©rence (ex: REF-001)
- Description d√©taill√©e
- Prix unitaire HT en TND (requis, 3 d√©cimales)
- Taux de TVA (s√©lection) :
  - 0% - Exon√©r√©
  - 7% - Taux r√©duit
  - 13% - Taux interm√©diaire
  - 19% - Taux normal (par d√©faut)
- Unit√© (s√©lection) :
  - Unit√©
  - Heure
  - Jour
  - Mois
  - Kilogramme
  - Litre
  - M√®tre carr√©
  - Forfait
- Statut actif/inactif (switch)

#### Actions
- ‚úÖ Cr√©er un nouveau produit
- ‚úÖ Modifier un produit existant
- ‚úÖ Supprimer un produit (avec confirmation)
- ‚úÖ Activer/d√©sactiver un produit

---

### 3. üìÑ Gestion des Factures

**Page : `/invoices`**

#### Fonctionnalit√©s
- ‚úÖ Liste compl√®te des factures
- ‚úÖ Recherche par num√©ro de facture ou nom de client
- ‚úÖ Badges de statut color√©s (brouillon, envoy√©e, pay√©e, en retard, annul√©e)
- ‚úÖ Affichage du montant total en TND
- ‚úÖ Date de facture format√©e
- ‚úÖ Tri par date d√©croissante

**Page : `/invoices/new` ou `/invoices/:id/edit` (Formulaire facture)**

#### Informations g√©n√©rales
- Client (s√©lection depuis la liste) - requis
- Type de facture :
  - Facture (standard)
  - Avoir (note de cr√©dit)
  - Compl√©mentaire
- Statut :
  - Brouillon
  - Envoy√©e
  - Pay√©e
  - En retard
  - Annul√©e
- Date de facture (requis)
- Date d'√©ch√©ance (requis)
- Conditions de paiement (ex: "Paiement √† 30 jours")

#### Lignes de facture
Tableau dynamique avec colonnes :
- Produit (s√©lection depuis le catalogue)
- Description (modifiable)
- Quantit√© (3 d√©cimales)
- Prix unitaire HT (3 d√©cimales)
- Taux TVA (%)
- Remise (%)
- Total ligne (calcul√© automatiquement)
- Action supprimer

**Boutons d'action :**
- ‚úÖ Ajouter une ligne
- ‚úÖ Supprimer une ligne
- ‚úÖ S√©lection produit avec pr√©-remplissage automatique

#### Calculs automatiques
- Sous-total HT
- Montant TVA
- Total TTC
- Application des remises ligne par ligne

#### Num√©rotation automatique
Format : `FACT-YYYY-XXXX`
- Exemple : FACT-2025-0001, FACT-2025-0002, etc.
- S√©quence par ann√©e
- G√©n√©ration automatique via fonction SQL

**Page : `/invoices/:id` (D√©tails facture)**

#### Sections

**1. Informations client**
- Nom
- Email
- T√©l√©phone
- Adresse
- Matricule fiscal

**2. D√©tails facture**
- Num√©ro de facture
- Type et statut
- Date de facture
- Date d'√©ch√©ance
- Conditions de paiement

**3. Montants**
- Total TTC
- Montant pay√© (en vert)
- Reste √† payer (en orange si > 0, vert si = 0)

**4. Lignes de facture**
Tableau d√©taill√© avec :
- Description
- Quantit√©
- Prix HT
- TVA %
- Remise %
- Total

R√©capitulatif :
- Sous-total HT
- Remise globale (si applicable)
- Montant TVA
- Total TTC

**5. Gestion des paiements**

Dialog "Ajouter un paiement" :
- Montant (TND, 3 d√©cimales)
- Date de paiement
- Mode de paiement :
  - Esp√®ces
  - Ch√®que
  - Virement bancaire
  - Carte bancaire
  - Pr√©l√®vement
  - Autre
- R√©f√©rence (num√©ro de ch√®que, r√©f√©rence virement, etc.)
- Notes

Tableau des paiements :
- Date
- Mode de paiement
- R√©f√©rence
- Montant
- Action supprimer (avec confirmation)

**6. Notes**
Affichage des notes de la facture (si pr√©sentes)

#### Actions principales
- ‚úÖ Modifier la facture
- ‚úÖ Supprimer la facture (avec confirmation)
- ‚úÖ Ajouter un paiement
- ‚úÖ Supprimer un paiement

---

### 4. üìä Rapports et Statistiques

**Page : `/reports`**

#### Filtrage par p√©riode
- Date de d√©but (s√©lecteur)
- Date de fin (s√©lecteur)
- Bouton "G√©n√©rer le rapport"

#### Indicateurs cl√©s (KPIs)
Trois cartes affichant :
1. **Chiffre d'affaires total** (sur la p√©riode)
2. **Montant encaiss√©** (paiements re√ßus, en vert)
3. **Montant en attente** (reste √† payer, en orange)

#### Analyses d√©taill√©es

**1. Factures par statut**
Tableau :
- Statut
- Nombre de factures
- Total TND

**2. Paiements par m√©thode**
Tableau :
- Mode de paiement
- Nombre de paiements
- Total TND

**3. Derni√®res factures**
Liste des 10 derni√®res factures avec :
- Num√©ro
- Client
- Date
- Statut
- Montant
- Cliquable pour voir les d√©tails

---

### 5. üè† Tableau de bord

**Page : `/dashboard`**

#### Statistiques en temps r√©el
Quatre cartes :
1. **Factures** - Nombre total
2. **Clients** - Nombre total
3. **Produits** - Nombre total
4. **Chiffre d'affaires** - Total en TND

---

### 6. üìÑ Gestion des Bons de Commande

**Page : `/purchase-orders`**

#### Fonctionnalit√©s
- ‚úÖ Liste compl√®te des bons de commande
- ‚úÖ Recherche par num√©ro de bon de commande ou nom de client
- ‚úÖ Badges de statut color√©s (brouillon, envoy√©, confirm√©, livr√©, annul√©)
- ‚úÖ Affichage du montant total en TND
- ‚úÖ Date de bon de commande format√©e
- ‚úÖ Tri par date d√©croissante

**Page : `/purchase-orders/new` ou `/purchase-orders/:id/edit` (Formulaire bon de commande)**

#### Informations g√©n√©rales
- Client (s√©lection depuis la liste) - requis
- Date de bon de commande (requis)
- Date de livraison pr√©vue (requis)
- Statut :
  - Brouillon
  - Envoy√©
  - Confirm√©
  - Livr√©
  - Annul√©
- Conditions de livraison (ex: "Livraison dans les 30 jours")

#### Lignes de bon de commande
Tableau dynamique avec colonnes :
- Produit (s√©lection depuis le catalogue)
- Description (modifiable)
- Quantit√© (3 d√©cimales)
- Prix unitaire HT (3 d√©cimales)
- Taux TVA (%)
- Remise (%)
- Total ligne (calcul√© automatiquement)
- Action supprimer

**Boutons d'action :**
- ‚úÖ Ajouter une ligne
- ‚úÖ Supprimer une ligne
- ‚úÖ S√©lection produit avec pr√©-remplissage automatique

#### Calculs automatiques
- Sous-total HT
- Montant TVA
- Total TTC
- Application des remises ligne par ligne

#### Num√©rotation automatique
Format : `BC-YYYY-XXXX`
- Exemple : BC-2025-0001, BC-2025-0002, etc.
- S√©quence par ann√©e
- G√©n√©ration automatique via fonction SQL

**Page : `/purchase-orders/:id` (D√©tails bon de commande)**

#### Sections

**1. Informations client**
- Nom
- Email
- T√©l√©phone
- Adresse
- Matricule fiscal

**2. D√©tails bon de commande**
- Num√©ro de bon de commande
- Statut
- Date de bon de commande
- Date de livraison pr√©vue
- Conditions de livraison

**3. Montants**
- Total TTC

**4. Lignes de bon de commande**
Tableau d√©taill√© avec :
- Description
- Quantit√©
- Prix HT
- TVA %
- Remise %
- Total

R√©capitulatif :
- Sous-total HT
- Remise globale (si applicable)
- Montant TVA
- Total TTC

**5. Notes**
Affichage des notes du bon de commande (si pr√©sentes)

#### Actions principales
- ‚úÖ Modifier le bon de commande
- ‚úÖ Supprimer le bon de commande (avec confirmation)
- ‚úÖ Changer le statut

---

### 7. üîê Authentification et S√©curit√©

**Page : `/auth`**

#### Fonctionnalit√©s
- ‚úÖ Connexion par email/mot de passe
- ‚úÖ Inscription de nouveaux utilisateurs
- ‚úÖ R√©initialisation de mot de passe
- ‚úÖ Session persistante

#### S√©curit√©
- ‚úÖ Row Level Security (RLS) sur toutes les tables
- ‚úÖ Isolation des donn√©es par utilisateur (user_id)
- ‚úÖ Politiques de s√©curit√© strictes :
  - Un utilisateur ne peut voir que ses propres donn√©es
  - CRUD limit√© aux ressources poss√©d√©es
- ‚úÖ Authentification via Supabase Auth
- ‚úÖ Tokens JWT s√©curis√©s

---

## üí∞ Format Mon√©taire TND

### Sp√©cificit√©s tunisiennes
- **Symbole** : DT (Dinar Tunisien)
- **Format** : `X XXX,XXX DT`
- **D√©cimales** : 3 (millimes)
- **Exemples** :
  - 1 234,567 DT
  - 50,000 DT
  - 999 999,999 DT

### Utilitaires disponibles (`/src/lib/currency.ts`)

```typescript
formatTND(amount)              // Formatte en TND avec symbole
formatNumber(amount, decimals) // Formatte sans symbole
parseTND(formatted)            // Parse une cha√Æne TND en nombre
calculateTax(amount, rate)     // Calcule la TVA
calculateWithTax(amount, rate) // Montant TTC
calculateDiscount(amount, %)   // Calcule une remise
calculateLineTotal(...)        // Total ligne avec remise
calculateInvoiceTotals(...)    // Totaux facture complets
```

---

## üóÑÔ∏è Structure de la Base de Donn√©es

### Tables principales

**1. clients**
- id (UUID)
- user_id (UUID) - Propri√©taire
- name (TEXT) - Nom/Raison sociale
- email (TEXT)
- phone (TEXT)
- address (TEXT)
- city (TEXT)
- postal_code (TEXT)
- country (TEXT) - D√©faut: "Tunisie"
- tax_id (TEXT) - Matricule fiscal
- tva_number (TEXT)
- notes (TEXT)
- created_at, updated_at

**2. products**
- id (UUID)
- user_id (UUID)
- name (TEXT)
- description (TEXT)
- unit_price (DECIMAL 10,2)
- tax_rate (DECIMAL 5,2) - D√©faut: 19%
- unit (TEXT) - D√©faut: "unit√©"
- reference (TEXT)
- is_active (BOOLEAN) - D√©faut: true
- created_at, updated_at

**3. invoices**
- id (UUID)
- user_id (UUID)
- invoice_number (TEXT) - Unique par utilisateur
- client_id (UUID) - FK vers clients
- invoice_date (DATE)
- due_date (DATE)
- status (TEXT) - brouillon|envoy√©e|pay√©e|en_retard|annul√©e
- type (TEXT) - facture|avoir|complementaire
- currency (TEXT) - D√©faut: "TND"
- subtotal (DECIMAL 10,2)
- tax_amount (DECIMAL 10,2)
- discount_amount (DECIMAL 10,2)
- total (DECIMAL 10,2)
- notes (TEXT)
- payment_conditions (TEXT)
- created_at, updated_at

**4. invoice_items**
- id (UUID)
- invoice_id (UUID) - FK vers invoices
- product_id (UUID) - FK vers products (nullable)
- description (TEXT)
- quantity (DECIMAL 10,2)
- unit_price (DECIMAL 10,2)
- tax_rate (DECIMAL 5,2)
- discount_percent (DECIMAL 5,2)
- total (DECIMAL 10,2)
- created_at

**5. payments**
- id (UUID)
- invoice_id (UUID) - FK vers invoices
- amount (DECIMAL 10,2)
- payment_date (DATE)
- payment_method (TEXT) - especes|cheque|virement|carte|prelevement|autre
- reference (TEXT)
- notes (TEXT)
- created_at

**6. purchase_orders**
- id (UUID)
- user_id (UUID)
- order_number (TEXT) - Unique par utilisateur
- client_id (UUID) - FK vers clients
- order_date (DATE)
- delivery_date (DATE)
- status (TEXT) - draft|sent|confirmed|delivered|cancelled
- currency (TEXT) - D√©faut: "TND"
- subtotal (DECIMAL 10,2)
- tax_amount (DECIMAL 10,2)
- discount_amount (DECIMAL 10,2)
- total (DECIMAL 10,2)
- notes (TEXT)
- delivery_conditions (TEXT)
- created_at, updated_at

**7. purchase_order_items**
- id (UUID)
- purchase_order_id (UUID) - FK vers purchase_orders
- product_id (UUID) - FK vers products (nullable)
- description (TEXT)
- quantity (DECIMAL 10,2)
- unit_price (DECIMAL 10,2)
- tax_rate (DECIMAL 5,2)
- discount_percent (DECIMAL 5,2)
- total (DECIMAL 10,2)
- created_at

### Fonctions SQL

**generate_invoice_number()**
G√©n√®re automatiquement un num√©ro de facture s√©quentiel par ann√©e.
Format: FACT-YYYY-XXXX

**generate_order_number()**
G√©n√®re automatiquement un num√©ro de bon de commande s√©quentiel par ann√©e.
Format: BC-YYYY-XXXX

---

## üöÄ Navigation et Routing

### Routes principales

```
/                    ‚Üí Page d'accueil
/auth                ‚Üí Authentification
/dashboard           ‚Üí Tableau de bord

/clients             ‚Üí Liste des clients
/clients/new         ‚Üí Nouveau client
/clients/:id         ‚Üí Modifier client

/products            ‚Üí Liste des produits
/products/new        ‚Üí Nouveau produit
/products/:id        ‚Üí Modifier produit

/invoices            ‚Üí Liste des factures
/invoices/new        ‚Üí Nouvelle facture
/invoices/:id        ‚Üí D√©tails facture + paiements
/invoices/:id/edit   ‚Üí Modifier facture

/purchase-orders     ‚Üí Liste des bons de commande
/purchase-orders/new ‚Üí Nouveau bon de commande
/purchase-orders/:id ‚Üí D√©tails bon de commande
/purchase-orders/:id/edit ‚Üí Modifier bon de commande

/reports             ‚Üí Rapports et statistiques
```

### Navigation lat√©rale

Menu disponible sur toutes les pages :
- üè† Tableau de bord
- üìÑ Factures
- üìÑ Bons de commande
- üë• Clients
- üì¶ Produits
- üìä Rapports

---

## üé® Interface Utilisateur

### Design System
- **Framework** : Shadcn-ui + Radix UI
- **Styling** : Tailwind CSS
- **Th√®me** : Dark mode compatible
- **Responsive** : Mobile-first design
- **Accessibilit√©** : ARIA compliant

### Composants principaux
- Cards avec bordures et ombres
- Tables responsives
- Formulaires avec validation
- Dialogs modaux
- Badges de statut color√©s
- Boutons avec ic√¥nes
- Inputs avec labels
- Selects personnalis√©s
- Toasts pour notifications

---

## ‚úÖ Conformit√© et Normes

### Normes fiscales tunisiennes
- ‚úÖ Taux de TVA tunisiens (0%, 7%, 13%, 19%)
- ‚úÖ Format matricule fiscal tunisien
- ‚úÖ Num√©rotation factures conforme
- ‚úÖ Mentions l√©gales (√† personnaliser)

### RGPD et Protection des donn√©es
- ‚úÖ Isolation des donn√©es par utilisateur
- ‚úÖ Cryptage des donn√©es en transit (HTTPS)
- ‚úÖ Authentification s√©curis√©e
- ‚úÖ Pas de partage de donn√©es entre utilisateurs

### Archivage
- ‚úÖ Conservation illimit√©e des factures
- ‚úÖ Historique complet des modifications (updated_at)
- ‚úÖ Tra√ßabilit√© des paiements
- ‚úÖ Recherche rapide

---

## üì± Compatibilit√©

### Navigateurs support√©s
- Chrome/Edge (derni√®res versions)
- Firefox (derni√®res versions)
- Safari (derni√®res versions)
- Mobile browsers (iOS Safari, Chrome Mobile)

### Appareils
- ‚úÖ Desktop (optimis√©)
- ‚úÖ Tablette (responsive)
- ‚úÖ Mobile (menu adaptatif)

---

## üîÑ Flux de travail typique

### Sc√©nario : Cr√©er et encaisser une facture

1. **Cr√©er le client** (si nouveau)
   - `/clients/new`
   - Remplir les informations
   - Enregistrer

2. **Cr√©er les produits** (si nouveaux)
   - `/products/new`
   - D√©finir prix et TVA
   - Enregistrer

3. **Cr√©er la facture**
   - `/invoices/new`
   - S√©lectionner le client
   - Ajouter des lignes de produits
   - Ajuster quantit√©s/remises
   - Statut : "Envoy√©e"
   - Enregistrer

4. **Envoyer la facture au client**
   - Consulter `/invoices/:id`
   - Imprimer/Exporter (√† impl√©menter)

5. **Enregistrer le paiement**
   - Sur `/invoices/:id`
   - Cliquer "Ajouter un paiement"
   - Saisir montant et mode
   - Enregistrer

6. **Suivre les encaissements**
   - Consulter le tableau de bord
   - Ou g√©n√©rer un rapport `/reports`

---

## üéØ Prochaines √©volutions possibles

### Fonctionnalit√©s sugg√©r√©es
- üìÑ Export PDF des factures
- üìß Envoi par email
- üìä Graphiques avanc√©s dans les rapports
- üíº Gestion multi-entreprises
- üîî Notifications de relance
- üì± Application mobile
- üåç Multi-devises
- üì¶ Gestion de stock
- üßæ Devis/Proformas
- üîó Int√©gration ERP/comptabilit√©

---

## üìû Support

Pour toute question sur l'utilisation de l'application, consultez ce guide ou contactez l'√©quipe de d√©veloppement.

**Version** : 1.0.0  
**Date** : Octobre 2025  
**Devise** : TND (Dinar Tunisien)  
**Pays** : Tunisie üáπüá≥
